{% extends "layout.html" %}
{% block title %}Zero-OS Hub{% endblock %}

{% block content %}
<div class="jumbotron">
    <div class="container">
        <h1>Hello you !</h1>
        <p>Do you want to publish your Zero-OS flist to our hub? It's easy.</p>
        <p>All you need is a <code>.tar.gz</code> archive of your files and upload it here. Simple.</p>
        <p><a class="btn btn-primary btn-lg" href="/upload" role="button">Upload my file</a></p>
    </div>
</div>

<div class="container">
<div id="home" style="display: block;">
    <h2>Official Repositories</h2>
    <table class="table table-hover" id="trusted">
        <thead>
            <tr>
                <td style="width: 50%;">Repository</td>
            </tr>
        </thead>

        <tbody>
        <tr>
            <td>Loading repositories...</td>
        </tr>
        </tbody>
    </table>

    <h2>Contributors</h2>
    <table class="table table-hover" id="contributors">
        <thead>
            <tr>
                <td style="width: 50%;">Username</td>
            </tr>
        </thead>

        <tbody>
        <tr>
            <td>Loading users...</td>
        </tr>
        </tbody>
    </table>
</div>

<script>
function buildlist(repositories) {
    $("#trusted tbody").empty()
    $("#contributors tbody").empty();

    for(var index in repositories) {
        var repository = repositories[index];
        var username = repository['name'];

        var target = repository['official'] ? 'trusted' : 'contributors';
        var trclass = repository['official'] ? 'warning' : '';

        var span = $('<span>', {'class': 'glyphicon glyphicon-certificate ' + target});
        var href = $('<a>', {'href': username}).html(username);
        var tr = $('<tr>', {'class': trclass}).append($('<td>').append(span).append(href));

        $('#' + target + ' tbody').append(tr);
    }
}

$(document).ready(function() {
    $.get("/api/repositories", function(data) {
        buildlist(data);
    });
});
</script>
{% endblock %}
